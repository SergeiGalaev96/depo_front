{"ast":null,"code":"var rutoken = function (n) {\n  function t(n) {\n    return !!(n && n.call && n.apply);\n  }\n\n  function e(n, e) {\n    return t(n[e]) ? function () {\n      return n[e].apply(n, arguments);\n    } : n[e];\n  }\n\n  function r(n) {\n    return function () {\n      return n;\n    };\n  }\n\n  function i() {\n    n.ready = Promise.resolve(!0), n.isExtensionInstalled = r(Promise.resolve(!1)), n.isPluginInstalled = r(Promise.resolve(!0)), n.loadPlugin = l, window.rutokenLoaded = s;\n  }\n\n  function o() {\n    var t = y.initialize().then(function () {\n      return y.isPluginInstalled();\n    }).then(function (t) {\n      return n.isExtensionInstalled = r(Promise.resolve(!0)), n.isPluginInstalled = e(y, \"isPluginInstalled\"), t && (m = \"application/x-rutoken-plugin\", n.loadPlugin = a), !0;\n    });\n    n.ready = t;\n  }\n\n  function u() {\n    n.ready = Promise.resolve(!0), n.isExtensionInstalled = r(Promise.resolve(!1)), n.isPluginInstalled = r(Promise.resolve(!1));\n  }\n\n  function l() {\n    var n = document.createElement(\"object\");\n    n.style.setProperty(\"visibility\", \"hidden\", \"important\"), n.style.setProperty(\"width\", \"0px\", \"important\"), n.style.setProperty(\"height\", \"0px\", \"important\"), n.style.setProperty(\"margin\", \"0px\", \"important\"), n.style.setProperty(\"padding\", \"0px\", \"important\"), n.style.setProperty(\"border-style\", \"none\", \"important\"), n.style.setProperty(\"border-width\", \"0px\", \"important\"), n.style.setProperty(\"max-width\", \"0px\", \"important\"), n.style.setProperty(\"max-height\", \"0px\", \"important\"), n.innerHTML = \"<param name='onload' value='rutokenLoaded'/>\", n.setAttribute(\"type\", m), document.body.appendChild(n);\n    var t = new Promise(function (n, t) {\n      h.push(n);\n    });\n    return t;\n  }\n\n  function a() {\n    return y.loadPlugin().then(function (n) {\n      return c(n);\n    }).then(function (n) {\n      return n.wrapWithOldInterface = p, n;\n    });\n  }\n\n  function s(n, t) {\n    d(n).then(function (n) {\n      if (0 == h.length) throw \"Internal error\";\n      var t = h.shift();\n      t(n);\n    });\n  }\n\n  function c(n) {\n    var r = {},\n        i = [];\n\n    for (var o in n) !function (o) {\n      t(n[o].then) ? i.push(n[o].then(function (i) {\n        return c(i).then(function (i) {\n          t(i) ? r[o] = e(n, o) : r[o] = i;\n        });\n      })) : r[o] = n[o];\n    }(o);\n\n    return 0 == i.length ? new Promise(function (t) {\n      t(n);\n    }) : Promise.all(i).then(function () {\n      return r;\n    });\n  }\n\n  function p() {\n    var n = {};\n\n    for (var e in this) t(this[e]) ? n[e] = function (n, t) {\n      return function () {\n        var e = arguments[arguments.length - 2],\n            r = arguments[arguments.length - 1],\n            i = Array.prototype.slice.call(arguments, 0, -2);\n        return t.apply(n, i).then(function (n) {\n          e(n);\n        }, function (n) {\n          r(n.message);\n        });\n      };\n    }(this, this[e]) : n[e] = this[e];\n\n    return new Promise(function (t) {\n      t(n);\n    });\n  }\n\n  function f() {\n    var n = {\n      originalObject: this.originalObject\n    };\n\n    for (var t in this.originalObject) n[t] = e(this.originalObject, t);\n\n    return new Promise(function (t) {\n      t(n);\n    });\n  }\n\n  function d(n) {\n    var e = {\n      originalObject: n,\n      wrapWithOldInterface: f\n    };\n\n    for (var r in n) t(n[r]) ? e[r] = function (n, t) {\n      return function () {\n        var e = Array.prototype.slice.call(arguments);\n        return new Promise(function (r, i) {\n          e.push(r, i), t.apply(n, e);\n        });\n      };\n    }(n, n[r]) : e[r] = n[r];\n\n    return new Promise(function (n) {\n      n(e);\n    });\n  }\n\n  var h = [],\n      m = \"application/x-rutoken-pki\",\n      y = window[\"C3B7563B-BF85-45B7-88FC-7CFF1BD3C2DB\"];\n  if (y) o();else if (navigator.mimeTypes && navigator.mimeTypes[m]) i();else try {\n    new ActiveXObject(\"Aktiv.CryptoPlugin\");\n    i();\n  } catch (P) {\n    u();\n  }\n  return n;\n}(rutoken || {});\n\n\"undefined\" != typeof module && (module.exports = rutoken);","map":null,"metadata":{},"sourceType":"script"}